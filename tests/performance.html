<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Performance testcase</title>
<script type="text/javascript" src="../jscripts/tiny_mce/tiny_mce_dev.js"></script>
<link rel="stylesheet" href="css/unit.css">
<script type="text/javascript">
var editor;

var performanceTests = {
	'Cleanup text blocks': {
		setup: function() {
			var html = '';
			
			// Generate some paragraphs with words in them
			for (var i = 0; i < 500; i++) {
				html += '<p>';

				for (var a = 0; a < 100; a++)
					html += 'word' + i + ',' + a + '    ';

				html += '</p>';
			}

			editor.setContent(html);
		},

		run: function() {
			return editor.getContent();
		}
	},

	'Cleanup text blocks with entities': {
		setup: function() {
			var html = '';
			
			// Generate some paragraphs with words in them
			for (var i = 0; i < 500; i++) {
				html += '<p>';

				for (var a = 0; a < 100; a++)
					html += 'word' + i + ',' + a + ' &aring;&auml;&ouml;';

				html += '</p>';
			}

			editor.setContent(html);
		},

		run: function() {
			return editor.getContent();
		}
	},

	'Url parsing tests': {
		run: function() {
			for (var i = 0; i < 200; i++) {
				new tinymce.util.URI('http://www.site.com/dir1/dir2/file.html').toRelative('http://www.site.com/dir1/dir3/file.html');
				new tinymce.util.URI('http://www.site.com/dir1/dir2/file.html').toRelative('http://www.site.com/dir3/dir4/file.html'); 
				new tinymce.util.URI('http://www.site.com/dir1/dir2/').toAbsolute('../dir3');
				new tinymce.util.URI('http://www.site.com/dir1/dir2/').toAbsolute('../dir3', 1);
			}
		}
	},

	'Style parsing/serializing tests': {
		run: function() {
			for (var i = 0; i < 1000; i++) {
				tinymce.DOM.serializeStyle(
					tinymce.DOM.parseStyle('border:1px solid red; background-image:url(some/dir/file.gif); font-size: 15px; color:rgb(1,2,3)')
				);
			}
		}
	}
};

tinyMCE.init({
	mode : "exact",
	elements : "elm1",
	theme : "advanced",
	add_unload_trigger : false,
	init_instance_callback : function(ed) {
		var count = 0;

		editor = ed;

		ed.onNodeChange.addToTop(function() {
			return false;
		});

		tinymce.each(performanceTests, function(test, title) {
			tinymce.DOM.add('tests', 'li', null, '<a id="test_' + (++count) + '" href="#">' + title + '</a>');
			tinymce.DOM.bind('test_' + count, 'click', function(e) {
				e.preventDefault();
				e.target.innerHTML = title + ' (running)';

				setTimeout(function() {
					var i, time, times = [], sum = 0;

					for (i = 0; i < 10; i++) {
						if (test.setup)
							test.setup();

						time = +new Date;
						test.run();
						times.push((+new Date) - time);
					}

					for (i = 0; i < times.length; i++) {
						sum += times[i];
					}

					e.target.innerHTML = title + ' (' + (sum / times.length) + 'ms)';
				}, 1);
			});
		});
	}
});
</script>
</head>
<body>
	<h1>Performance tests</h1>
	<ul id="tests"></ul>
	<textarea id="elm1"></textarea>
</body>
</html>
